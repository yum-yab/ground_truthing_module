---
title: "Comparison of canopy height measurement between TLS and Sentinel2 data"
subtitle: "Documentation"
subsubtitle: "Leaf traits measurements"
# Ok I reallly dont know why this does not work, 
# author: | 
#     | **Group 4** 
#     | Denis Streitmatter 
#     | Marie-Louise Korte 
#     | Louis Trinkle 
#     | Maxwell Sivertsen 
#     | Fabian Götz 
#     | Lukas Erzfeld
author:  
    # - **Group 4** 
    - Denis Streitmatter 
    - Marie-Louise Korte 
    - Louis Trinkle 
    - Maxwell Sivertsen 
    - Fabian Götz 
    - Lukas Erzfeld
date: last-modified
format:
    pdf:
        documentclass: scrreport
        theme: united
        toc: false
        toc-depth: 2
        number-sections: false 
        number-depth: 1
        toc-title: Table of Contents
        toc-location: body
        colorlinks: true
header-includes:  
- \usepackage{graphicx}
- \usepackage{lscape}
- \usepackage{array} 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
{{< pagebreak >}}

# Submission 4: TLS and Sentinel 2 comparison


## General study concept and conditions

The purpose of this document is the comparison of terrestial laser/LiDAR scanning and Sentinel 2 (satellite) data of the same spot.


**Study conditions:**

- Sunny weather with a few clouds, ~ 23°
- Location in the Leipzig Auwald, near the canopy crane (exact location can be seen in the figures)
- Tools: terrestrial laser scanning (TLS), QGIS, Cloud Compare, R

**Methodology**:

1. TLS measurement was carried out at breast height
2. Preprocessing of the TLS data via CloudCompare^[See [https://www.cloudcompare.org/](https://www.cloudcompare.org/)]
3. QGIS was used for visualizing the sentinel data and creating the area of interest
4. `R` was used to resample the TLS data to match the resolution of the Sentinel data
5. `R` was also used to calculate the residuals and generally producing all figures in this document (importing the results of step 2, 3 and 4)^[The code for everything can be found here [https://github.com/yum-yab/ground_truthing_module/blob/main/submission_4/TLS_plots/TLS_plots.R](https://github.com/yum-yab/ground_truthing_module/blob/main/submission_4/TLS_plots/TLS_plots.R)]


## Results

This section lists, describes and explains the plots and graphs generated by the algorithm described in the previous section.

### Tree height statistic comparison

In this section the general measurements are compared. 


The TLS height measurement is shown in @fig-tls-heights. It can be seen in the left plot that the TLS data is far more fine grained than the data of the Senitnel2 satellite (see @fig-sentinel-height). 
For better comparison the TLS got resampled to match the resolution of the sentiel data (see @fig-tls-heights)
The difference in granularity can also been seen in the comparison of distribution of height and the standard derivations (see @fig-comparison-histograms): 
While the height of TLS data is distributed evenly across the the whole height spectrum, the sentinel 2 data maps the whole area to around 30 meters. 
This can also be seen in @fig-sentinel-height, which uses the same colormap as @fig-tls-heights, but is very uniformly distributed.





![Height calculation of TLS (left raw, right resampled to resolution of the sentinel data)](TLS_plots/figures/chm_tls_height_both_res.png){#fig-tls-heights}

![Height of the Sentinel 2 data](TLS_plots/figures/sentinel_height.png){#fig-sentinel-height}

![Height distribution and standard derivation of both Sentinel and TLS data as histograms](TLS_plots/figures/histograms.png){#fig-comparison-histograms}

The reason for this is simple and twofold:

1. **Resolution of satellite data**: The sheer distance of the satellite results in far lower resolution, resulting in "spacial aggregation", mapping a calculated value to a far larger area than the TLS data. 
2. **Way of measurement**: While the TLS scans from below and can therefor see the lower trees, Sentinel 2 measures from (very far) above, occluding the lower trees. This results in an overestimation of tree heights.
But vice versa, the TLS data probably underestimates the canopy height, since lower trees can occlude the actual canopy.

{{< pagebreak >}}

### Comparison via residuals

We computed the residuals by using the far more finely resolved TLS data as truth and subtract the sentiel data from it. The result can be seen in @fig-residuals-stats. 
But there are a few things to consider:
1. As briefly explained in the prevoius section, lower branches can occlude the actual canopy, resulting in an underestiation of the canopy height
2. Also the further away from the device a tree is, the more likely it is to be (partly) occluded by closer objects.

As expected, the Sentinel 2 data generally overestimates the canopy height, with a far larger part having negative residuals (colored red in @fig-residuals-stats). 
Interestingly only a small section in the map (bottom right, the area with the highest trees according to TLS data) is underestimated. 


![Residuals of the comparison. The far more precise TLS data serves here as the truth. Left is a map of residuals, right is a histogram of the distribution](TLS_plots/figures/residuals_stats.png){#fig-residuals-stats}

## Conclusion

In conclusion, it is shown that TLS and satellite data differ greatly in terms of resolution and variance, which is no surprise. 
Of course, the big advantage of using satellites, that can cover much larger areas, is over looked in this approach to make it compareable to the TLS by selecting only a small area.
Furthermore, it is not entirely clear how good the values from the TLS actually are. 
We used it as ground truth for calculating the residuals from the Sentinel data, but there are actually a few problems with this method, as explained before. 
An interesting approach would be comparing TLS data to UAV data, which could show the possible underestimation of the TLS.

So all in all, satellites are well suited for measuring vast areas, but lack the necessary precision to be used in precise, local measurements.
On the other hand, TLS also has some systematic problems, which may be overcome by certain methods (multiple scanning from different locations and merge of the results, scanning at a higher level etc.).  