---
title: "Field training 02 - Leaf traits measurements"
subtitle: "Documentation"
subsubtitle: "Leaf traits measurements"
author: 
    - "Group 4" 
    - "Denis Streitmatter"
    - "Marie-Louise Korte"
    - "Louis Trinkle"
    - "Maxwell Sivertsen"
    - "Fabian Götz"
    - "Lukas Erzfeld"
date: last-modified
format:
    pdf:
        documentclass: scrreport
        theme: united
        toc: true
        toc-depth: 2
        number-sections: false 
        number-depth: 1
        toc-title: Table of Contents
        toc-location: body
        colorlinks: true
header-includes:  
- \usepackage{graphicx}
- \usepackage{lscape}
- \usepackage{array}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
{{< pagebreak >}}

# Task 1: Leaf sampling

<!-- Task1: Leaf sampling in the park and quick run through of all processing steps -->

Date: 23.05.2023


<!-- Participants: Dennis, Fabian, Louis, Lukas, Marie-Louise, Maxwell -->

Coordinates: 51.332222, 12.384167

Material used for Sampling:

- Paper Bags and Pencil
- Smartphone (GPS + plant species determination)
- Book (Flora Vegetativa)
- Survey sheet

Materials used for Analysis:

- Soil Plant Analysis Development (SPAD) meter for chlorophyll measurements
- Precision balance
- Leaf scanner
- A4 paper and camera
- Drying cabinet


The aim of the leaf property sampling was to collect and analyse leaf traits of different plant species. On May 23rd 2023, we collected leaf samples of eight different species in Kanonenteichanlage, a small park between Liebigstraße and Brüderstraße in 04103 Leipzig, Germany. 

The plant species that were sampled were choosen based on their abundance in the park. For each species 10 leaves from different individuals were sampled. When sampling leaves we were careful to sample the whole leaf. Leaves were chosen based on the following criteria, healthy, fully grown and from a sun-lit environment where possible. We sampled trees, shrubs and herbs. The plants were identified using the smartphone app 'FloraIncognita' and the latin names of the species were recorded in a table. The leaves were collected in labeled paper bags and taken back to the seminar room for further analyisis. The leaf traits recorded for each species were fresh weight, dry weight, leaf area, and chlorophyll content. The fresh weight was determined first using a precision balance. In the next step chlorophyll concentration was derived from plant greenness using a Soil Plant Analysis Development (SPAD) meter. We used the leaf scanner to measure leaf area, we also took pictures of the leafs on an A4 sheet to derive leaf area using a script for image analysis. The leaves were then put in a drying cabinate at 50° to 55° for 48h. In a last step dry weight was determined. All the data was recorded in a google sheet. 


{{< pagebreak >}}



# Task 2: Leaf chlorophyll measurements
## Procedure

Material used: 

- Leaf samples of 8 plant species
- Konica Minolta SPAD 502
- Leaf trait sheet of paper


The aim of this measurement was to determine the leaf chlorophyll content (per area) using the *Konica Minolta SPAD-502 Plus* device. This instrument measures leaf absorbance in red and near-infrared regions using two LEDs at peak wavelengths of 650 nm and 940 nm. It calculates a Soil Plant Analysis Development (SPAD) value by dividing the light transmission intensities and determines the relative chlorophyll content in the sample leaf (Konica Minolta Optics, 2012). A more detailed description of the instrument can be found under [Süß, A., Danner, M., Obster, C., Locherer, M., Hank, T., Richter, K. (2015): Measuring Leaf Chlorophyll Content with the Konica Minolta SPAD-502Plus – Theory, Measurement, Problems, Interpretation. EnMAP Field Guides Technical Report, GFZ Data Services](https://gfzpublic.gfz-potsdam.de/rest/items/item_1388302/component/file_1388303/content) (last accessed: 06/06/2023). 

We measured the chlorophyll content on the upper side of each leaf in four (*Geranium molle, G. sanguineum*) to six spots (*Acer platanoides, Alliaria petiolata, Ballota nigra, Geum urbanum, Philadelphus Coronarius, Spirae Chamaedryfolia*), depending on the leaf size and shape. During the measurement, we padi attention so that no obvious outliers were recorded, no veins were measured and that the optical window of the instrument was fully covered by the leaf. For each of the ten sampled leaves, the mean of the four to six measurements was written down on the leaf trait sheet (see columns *SPAD1...SPAD10* of table < INSERT TABLE NUMBERING>). Afterwards, the mean and standard deviation for all the leaves of each species were calculated.

## Chlorophyll conversions

In order to convert the mean values per species measured with the SPAD-instrument, the following equations from *Süß et al. (2015)* were used:

![Table with formulas to convert measured SPAD pigment values to chlorophyll per area values.](SPAD_conversion_table.png "Table with formulas to convert measured SPAD pigment values to chlorophyll per area values.")

It is to mention that the unit of the equation from Monje & Bugbee (1992) was wrong and therefore we divided the resulting values by 10. We further recalculated the equations from Markwell et al. (1995) from $\mu mol/mm^2$ to $\mu g/mm^2$ by multiplicating the values with 0.089348898 (because the molar mass of chlorophyll A is 893.48898 g/mol).

The results of the conversions can be seen in the attached data table as well as in the figure below.

![Variation of the different equations used to convert the measured SPAD-values to real chlorophyll values.](SPAD_conversion_variation.png "Variation of the different equations used to convert the measured SPAD-values to real chlorophyll values.")

All equations yield relatively similar results (see curves 2-5), except the one from Monje & Bugbee (1992), which results in lower values.

{{< pagebreak >}}

# Task 4: Leaf area measurement

In the next step, we determined the mass per leaf area.
For this task two different methods were used: A specialized scanner for this exact purpose and a python script calculating the leaf area based of photos on an a DIN-A4 paper.

## Specialized Scanner

 We took the sheets out of the paper bag and placed them one by one into the sheet scanner. We had to make sure that the sheets were fully spread out, did not overlap, and were within the measurement range area. For some sheets, the scanner was not large enough to measure all 10 sheets at once. So we did multiple scans and added up and documented the measured leaf area for each species.  

To check the correctness of the scanner we performed a second type of leaf surface measurement. For this, we placed the leaves on a DinA4 sheet and took a photo. We wrote a small script to convert the scans of sheets and paper into black and white images and calculate the cumulative sheet area from the proportion of black pixels of the total paper area. Then we compared the measured area with the result of the sheet scanner. They were very similar everywhere with slight variations (see documentation).  
There were two different approaches for measuring the leaf area: Using a specific tool or calculating it on the base of photos of the leafs on standardised A4 paper sheets

## Photo-based approach 

For this approach we took Photos of single or multiple leafs on one (or two) A4 papers. 
These photos were then preprocessed with the image-software `gimp` and then calculated the leaf size with a [python script](https://github.com/yum-yab/ground_truthing_module/blob/main/leaf_area_measure/leaf_area_measurement.py).
The photos (unprocessed and otherwise) can be found [here](https://github.com/yum-yab/ground_truthing_module/tree/main/leaf_area_measure/leaf_images)

### Preprocessing of the Photos

The goal of this step is to reduce the image to the necessary parts, mainly cutting out the A4 paper sheet. For this a few steps were performed:

1. Load the image in gimp
2. Use the `lasso-select tool` for selecting the corners of the A4 paper
3. Press `CTRL + i` for inverting the selection
4. Press `CTRL + x` for cutting out everything thats not on the paper
5. Use `Image > Crop to content` to reduce the image size
    - this step is optional since alpha channel (= transparency) is ignored in the script, but this reduces file size and therefor makes it a bit faster
6. Save images in proper format for script:
    - Name of the file `{leaf-number}_someuniquename_{double}.jpg` (only use `double` if two A4 papers were used)
    - save all files of one species in one directory

### Calculating the leaf size

The code and the description how to use it can be found in [this git repository](https://github.com/yum-yab/ground_truthing_module/blob/main/leaf_area_measure/). 
Here we will only describe the main ideas of the process. 
Since we know the area of the A4 paper, to determine leaf size we only need to know the number of `leaf-pixels` in relation to `leaf-pixels + paper-pixels` ($\equiv$ DIN-A4) and therefor we can calculate the area of the leaf. 
Unfortunately shadows of not fully flat leaves can add a lot of noise to the trivial approach (converting it to greyscale and cutting at a certain threshold). 
To fix this we transposed the image in the `HSV` color space, where all grey/white colors have a very low saturation value (compared to the green leaves), so we determine a  saturation threshold here (a comparison feature between Bitmask, `HSV` and original image was implemented to find a fitting value) and generate the bitmask in this way.
The transparent parts are not considered during the area calculation, only the white (paper), grey (shadows, counted as paper) and green (leaf) pixels.


## LMA

To calculate the biomass of the sheets, we now had to determine the dry weight of the sheets. To do this, we put the leaves back in the paper bag, and put them in the drying oven at 50 - 55 °C. The samples were dried for 72h. Then we measured the dry weight and noted the values. Finally we calculated the ratio of dry weight to leaf area in mg/cm², which is the Leaf mass per Aria (LMA).  
## Comparison to LEDA Database

Another task was to compare our LMA values with those from the LEDA database. There, the values were only available as SLA. So we had to convert them into LMA first. The result can be seen in the plots in the appendix. If several values were available for one plant, we calculated the mean value. For two plants no values were available in the LEDA database. Overall, our values are slightly higher than those in the database, but are very similar overall.

![Scatterplot comparing results of Leaf area from the scanner vs Leaf area out of camera photos.](leaf-area_scan_vs_cam.png "Scatterplot comparing results of Leaf area from the scanner vs Leaf area out of camera photos.")

# Task 3 & 5: Leaf water content

<!-- Task 3 and 5 -->
The total fresh weight and dry weight of the leave samples were used to determine the equivalent water thickness (EWT, @tbl-data-summary). The total weight of the leaves was determined through carefully placing the samples on precision laboratory balances. The equivalent water thickness is calculated by substracting the weight of the dry sample from the weight of the fresh sample and then deviding by the product of the density of water and the leaf area (@eq-EWT).


 $$
 EWT = \frac{fresh\: weight\: [mg]-dry\: weight\: [mg]}{1000\:\frac{mg}{cm^{3}}\; \; leaf\: area\: [cm^{2}]}
 $$ {#eq-EWT}

# Appendix

<!-- change to landscape -->
\KOMAoptions{paper=landscape,pagesize} 
\recalctypearea

<!-- please feel free to make these tables look prettier-->

| Species | Leaf area (scanner) cm² | Leaf area (camera) cm² | Fresh weight [mg] | Dry weight [mg] | LMA [mg/cm²] scanner | LMA [mg/cm²] camera | EWT [mg/cm²] scanner | EWT [mg/cm²] camera |
|---|---|---|---|---|---|---|---|---|
| Philadelphus Coronarius | 719.97 | 751.19 | 13830 | 2440 | 19.20913371 | 18.41078822 | 0.02 | 0.02 |
| Spirae Chamaedryfolia | 128.27 | 122.26 | 1760 | 620 | 13.72105715 | 14.39555047 | 0.01 | 0.01 |
| Geranium molle | 119.11 | 141.13 | 3590 | 590 | 30.14020653 | 25.43753986 | 0.03 | 0.02 |
| Alliaria petiolata | 810.5 | 892.12 | 17720 | 3630 | 21.8630475 | 19.86279873 | 0.02 | 0.02 |
| Geum urbanum | 184.8 | 194.62 | 2390 | 860 | 12.93290043 | 12.28034118 | 0.01 | 0.01 |
| Ballota nigra | 105.88 | 110.4 | 2090 | 610 | 19.73932754 | 18.93115942 | 0.01 | 0.01 |
| Geranium sanguineum | 82.62 | 97.56 | 1910 | 530 | 23.11788913 | 19.57769578 | 0.02 | 0.01 |
| Acer platanoides | 1142.2 | 1343.79 | 15110 | 4530 | 13.22885659 | 11.24431645 | 0.01 | 0.01 |

: Leaf properties: leaf area, leaf fresh and dry weight, LMA (leaf mass per area) and EWT (equivalent water thickness) {#tbl-data-summary}

{{< pagebreak >}}

| Species | SPAD mean | SPAD stdv | chl Eq. 1 | chl Eq. 2 | chl Eq. 3 | chl Eq. 4 | chl Eq. 5 |
|---|---|---|---|---|---|---|---|
| Philadelphus Coronarius | 47.65 | 1.681434573 | 26.5467675 | 55.53686838 | 54.35018076 | 61.56568402 | 62.75488428 |
| Spirae Chamaedryfolia | 45.6 | 3.215932559 | 24.38084 | 52.23613916 | 50.45974688 | 56.03685716 | 56.72252579 |
| Geranium molle | 36.1 | 3.919183588 | 15.55059 | 38.057711 | 34.49447706 | 36.23261347 | 35.51025089 |
| Alliaria petiolata | 27.64 | 1.416725489 | 9.3583776 | 26.97909046 | 22.96342652 | 24.57293509 | 23.40017292 |
| Geum urbanum | 28.03 | 2.746330886 | 9.6092139 | 27.45774932 | 23.44236855 | 25.01677595 | 23.85444116 |
| Ballota nigra | 38.44 | 4.576558629 | 17.5413216 | 41.37942519 | 38.12070678 | 40.34089174 | 39.8524312 |
| Geranium sanguineum | 48.9 | 6.534332407 | 27.91283 | 57.59152447 | 56.80304051 | 65.20131502 | 66.7438002 |
| Acer platanoides | 31.59 | 5.872998477 | 12.0535811 | 31.97027796 | 28.04602719 | 29.4575616 | 28.43095204 |

: Leaf properties: SPAD measurements and chlorophyll concentration from 5 different equations {#tbl-data-summary} 

{{< pagebreak >}}

\KOMAoptions{paper=portrait,pagesize} 
\recalctypearea
